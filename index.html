<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>金融频道</title>
		<link rel="stylesheet" type="text/css" href="css/weui.css"/>
		<link rel="stylesheet" type="text/css" href="css/swiper.min.css"/>
		<link rel="stylesheet" type="text/css" href="css/main.css"/>
		<link rel="stylesheet" type="text/css" href="css/weuimodify.css"/>
	</head>
	<body>
		<div id="app" v-cloak>
			<div id="loadingToast" v-show="isLoading">
				<div class="weui-mask_transparent"></div>
				<div class="weui-toast">
					<i class="weui-loading weui-icon_toast"></i>
					<p class="weui-toast__content">数据加载中</p>
				</div>
			</div>
			<div v-if="bannerList.length>0" class="swiper-container bannerswiper borderbottomgray">
				<div class="swiper-wrapper">
					<div class="swiper-slide" v-for="item in bannerList" :key="item.id">
						<a :href="item.url">
							<img class="slideimg" :src="item.img" />
						</a>
					</div>
				</div>
				<!-- 如果需要分页器 -->
				<div class="swiper-pagination"></div>
			</div>
			<div class="onlineBrand borderbottomgray">
				<div class="text">品牌活动</div>
				<div class="onlineswiper">
					<div class="swiper-wrapper">
						<div class="swiper-slide onlineslide" v-for="item in onlinelist" :key="item.id">
							<img src="src/hot.png" class="hot" v-if="item.ishot" />
							<img class="onlineimg" :src="item.img">
							<div v-text="item.text"></div>
						</div>
					</div>
				</div>
				<div v-if="onlinelist.length===0" style="text-align: center;">
					<noinfo info="品牌活动需再等等"></noinfo>
				</div>
			</div>
			<div class='bargain borderbottomgray'>
				<div class='text'>超值特惠</div>
				<a v-for="(item , index) in tehui" :class="'top'+(index+1)" :key="item.id" :href="item.url">
					<img class="bargainimg" :src='item.img' />
				  	<div class='tag'>No.{{index+1}}</div>
				  	<div v-if="!!item.title" class="bargaintitle oneline">{{item.title}}</div>
				  	<div v-if="!!item.name">
					  	<!-- <div class="bbtn">无卡申请</div> -->
					  	<div class="bname oneline">{{item.name}}</div>
				  	</div>
				</a>
				<div v-if="tehui.length===0" style="text-align: center;">
					<noinfo info="超值特惠很快就会有哦~"></noinfo>
				</div>
			 </div>
			 <div class="recommend borderbottomgray">
			 	<div class='text'>专属推荐</div>
				<div v-if="recommendlist.length>0">
					<div class="recommendswiper">
						<div class="swiper-wrapper">
							<div class="swiper-slide recommendslide"  v-for="item in recommendlist" :key="item" @click="selectrecom(item)">
								<span class="zhushuspan" :class="[activerecom===item?'activerecommend':'']">{{item}}</span>
							</div>
						</div>
					</div>
					<div class="reswiper swiper-container">
						<div class="swiper-wrapper">
							<div class="swiper-slide reslide swiper-no-swiping" v-for="(item,keyn) in compu_recommendObj[activerecom]" :key="keyn">
								<a :href="wuitem.url" class="wupin" v-for="(wuitem,wuindex) in item" :key="wuitem.id">
									<img :src="wuitem.img" class="wuimg" />
									<div class="midwu">
										<div class="wutitle oneline">{{wuitem.title}}</div>
										<div class="wudesc oneline">{{wuitem.desc}}</div>
									</div>
									<div class="wuopera"><span>{{wuitem.type}}</span></div>
								</a>
							</div>
						</div>
					</div>
					<div class="operare">
					<div class="opwrap" @click="oppre">
						<img src="src/up.jpg" class="tri" >
					</div>
					<div class="opwrap" @click="opnext">
						<img src="src/down.jpg" class="tri" >
					</div>
				</div>
			 </div>
			 <div v-if="recommendlist.length===0" style="text-align: center;">
			 	<noinfo info="专属推荐需再等等"></noinfo>
			 </div>
			</div>
			<div class="news">
				<div class='text'>热卡推荐</div>
				<a class="newlist" v-for="item in newslist" :key="item.id" :href="item.url">
					<div class="newstitle">{{item.title}}</div>
					<img :src="item.img" class="newsimg" />
				<a>
				<div v-if="newslist.length===0" style="text-align: center;">
					<noinfo info="最新信息还没出炉哦~"></noinfo>
				</div>
			</div>
		</div>
	</body>
	<script src="js/vue.min.js"></script>
	<script src="js/swiper.min.js"></script>
	<script src="js/axios.min.js"></script>
	<script>
		function setHtmlFoot(){
			var win=document.documentElement||document.getElementsByTagName("html")[0];
			var winWidth=win.offsetWidth;
			var footsize=100*winWidth/750;
			win.style.fontSize=footsize+"px";
		}
		window.onpageshow=function(){
			setHtmlFoot();
		}
		setHtmlFoot();
		//截流
		function debounce(fn,time){
			var timer=null;
			return function(){
				clearTimeout(timer);
				var args=arguments;
				timer=setTimeout(function(){
					fn.apply(null,args);
					
				},time)
			}
		}
		var setsize=debounce(setHtmlFoot,300);
		window.onresize=function(){
			setsize();
		}
	</script>
	</script>
	<script>
		var vm=new Vue({
			el:'#app',
			data:{
				isLoading:false,
				swipercount:1,//专属推荐页面个数
				bannerList: [],//轮播图列表
				onlinelist:[],//品牌活动列表
				tehui:[],//超值特惠列表
				reswiper:null,//专属推荐每银行活动的swiper
				activerecom:'',//默认选中的银行
				recommendObj:{},//获取每个银行以及所属活动列表
				newslist:[]//热卡推荐数据
			},
			methods:{
				opnext:function(){
					this.reswiper.updateSlides();
					this.reswiper.slideNext();
				},
				oppre:function(){
					this.reswiper.slidePrev();
				},
				selectrecom:function(item){
					this.activerecom=item;
					this.reswiper.updateSlides();
					this.reswiper.slideTo(0,0);
				},
				//获取banner轮播图样式资源
				getBannerhttp:function(){
					var ths=this;
					return axios.get('https://www.easy-mock.com/mock/5c468f8d3ea95957a403a95a/zhgroot/getbannerList')
											.then(function(res){
													ths.bannerList=res.data.data.list;
													ths.$nextTick(function(){
														//实例化轮播图swiper
														var mySwiper = new Swiper ('.bannerswiper', {
															loop: true, // 循环模式选项
															autoplay: {
																delay: 6000,
																stopOnLastSlide: false,
																disableOnInteraction: false,
																},
															// 如果需要分页器
															pagination: {
																el: '.swiper-pagination',
															}
														})
													});
											})
				},
				//获取品牌活动列表
				getBrandhttp:function(){
					var ths=this;
					return axios.get('https://www.easy-mock.com/mock/5c468f8d3ea95957a403a95a/zhgroot/getonlinelist')
											.then(function(res){
												ths.onlinelist=res.data.data.onlinelist;
												ths.$nextTick(function(){
													//实例化品牌活动swiper
													var onlineSwiper = new Swiper ('.onlineswiper', {
														slidesPerView : 4,
														slidesPerGroup : 1,
														})
												});
												
											})
				},
				//获取超值特惠数据
				getTehuihttp:function(){
					var ths=this;
					return axios.get('https://www.easy-mock.com/mock/5c468f8d3ea95957a403a95a/zhgroot/getTehuilist')
											.then(function(res){
												ths.tehui=res.data.data.tehui;
											})
				},
				//获取专属推荐数据
				getRecommendhttp:function(){
					var ths=this;
					return axios.get('https://www.easy-mock.com/mock/5c468f8d3ea95957a403a95a/zhgroot/getRecommendList')
											.then(function(res){
												let recommendObj=res.data.data.recommendObj||{};
												ths.recommendObj=recommendObj;
 												let arr=Object.keys(recommendObj);
 												ths.activerecom=arr.length>0?arr[0]:'无';
												ths.$nextTick(function(){
														var recommendswiper=new Swiper ('.recommendswiper', {
															slidesPerView : 3,
															slidesPerGroup : 1,
															})
														ths.reswiper=new Swiper ('.reswiper', {
															direction : 'vertical'
															})
												})
											})
				},
				//获取最新信息数据
				getNewshttp:function(){
					var ths=this;
					return axios.get('https://www.easy-mock.com/mock/5c468f8d3ea95957a403a95a/zhgroot/getNewsList')
											.then(function(res){
												ths.newslist=res.data.data.newslist;
											})
				},
				togetherhttp:function(){
					let ths=this;
					ths.isLoading=true;
					var arr=[this.getBannerhttp(),this.getBrandhttp(),this.getTehuihttp(),this.getRecommendhttp(),this.getNewshttp()];
					return axios.all(arr).then(function(){
						ths.isLoading=false;
					})
				}
			},
			computed:{
				compu_recommendObj:function(){
					const recommendObj = this.recommendObj;
					const maxlength=5;
					const arr=[];
					const obj=JSON.parse(JSON.stringify(recommendObj));
					for(var item in obj){
						var oparr=obj[item];
						let len=oparr.length;
						var smallobj={};
						for(var i=0;i<len;i++){
							var index=Math.floor(i/maxlength);
							smallobj[index]=!!smallobj[index]?smallobj[index]:[];
							smallobj[index].push(oparr[i]);
						}
						obj[item]=smallobj;
					}
					return obj;
				},
				recommendlist:function(){
					const recommendObj = this.recommendObj;
					const arr=[];
					return [...Object.keys(recommendObj)];
				}
			},
			created:function(){
				this.togetherhttp();
			},
			components:{
				'noinfo':{
					props:['info'],
					template:'<div style="display:inline-block"><img class="noinfoimg" style="width:2rem" src="./src/default.png" /><p style="color:#ccc">{{info}}</p></div>',
				}
			}
		})
	</script>
</html>